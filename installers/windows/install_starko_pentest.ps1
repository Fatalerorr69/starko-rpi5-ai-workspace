param(
    [string]$ProfileName = "StarkoPenTest",
    [switch]$InstallExtensions = $false
)

Write-Host "Installing Starko $ProfileName Workspace..." -ForegroundColor Cyan

$profileRoot = "$env:USERPROFILE\StarkoProfiles\$ProfileName"
$vsconfig = "$env:APPDATA\Code\User"
$workspaceRoot = Get-Location

# Create directories
mkdir "$env:USERPROFILE\StarkoProfiles" -Force
mkdir $profileRoot -Force
mkdir "$vsconfig\snippets" -Force

# Copy profile specific files
$profilePath = "$workspaceRoot\profiles\$ProfileName"
if (-not (Test-Path $profilePath)) {
    Write-Host "Profile $ProfileName does not exist!" -ForegroundColor Red
    exit 1
}

Copy-Item -Recurse -Force "$profilePath\.vscode\*" $vsconfig
Copy-Item -Recurse -Force "$profilePath\snippets\*" "$vsconfig\snippets"
Copy-Item -Recurse -Force "$profilePath\icons" $profileRoot
Copy-Item "$profilePath\*.code-workspace" $profileRoot -ErrorAction SilentlyContinue

# Copy shared scripts and tools
Copy-Item -Recurse -Force "$workspaceRoot\scripts" $profileRoot
Copy-Item -Recurse -Force "$workspaceRoot\tools" $profileRoot

# Install extensions if requested
if ($InstallExtensions) {
    Write-Host "Installing recommended extensions..." -ForegroundColor Yellow
    $extensions = Get-Content "$profilePath\.vscode\extensions.json" | ConvertFrom-Json
    foreach ($extension in $extensions.recommendations) {
        Write-Host "Installing $extension..." -ForegroundColor Gray
        code --install-extension $extension
    }
}

Write-Host "Installation complete! Profile location: $profileRoot" -ForegroundColor Green
Write-Host "Available scripts in: $profileRoot\scripts" -ForegroundColor Cyan
