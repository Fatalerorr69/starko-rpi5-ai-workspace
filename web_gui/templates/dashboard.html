
[A[3~
[A<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Starko AI Workspace 4.0</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Z√ÅKLADN√ç STYLY - zkr√°ceno pro p≈ôehlednost */
        :root {
            --primary: #4361ee; --secondary: #3f37c9; --success: #4cc9f0;
            --warning: #f72585; --danger: #e63946; --dark: #1d3557;
            --bg-dark: #0f172a; --bg-darker: #0a0f1c;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        
        body {
            background: var(--bg-dark);
            color: white;
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, var(--dark) 0%, var(--bg-darker) 100%);
            height: 100vh;
            position: fixed;
            overflow-y: auto;
            border-right: 1px solid rgba(255,255,255,0.1);
        }
        
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 30px;
        }
        
        .widget {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .widget:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
            border-color: var(--primary);
        }
        
        .profile-card {
            background: rgba(255,255,255,0.08);
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid var(--primary);
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .profile-card:hover {
            background: rgba(255,255,255,0.12);
            transform: translateX(5px);
        }
        
        .profile-card.active {
            border-left-color: var(--warning);
            background: rgba(247, 37, 133, 0.1);
        }
        
        .clickable { cursor: pointer; transition: all 0.2s; }
        .clickable:hover { transform: scale(1.05); }
        .clickable:active { transform: scale(0.95); }
    </style>
</head>
<body>
    <!-- SIDEBAR -->
    <div class="sidebar">
        <div class="sidebar-header" style="padding: 25px; border-bottom: 1px solid rgba(255,255,255,0.1); text-align: center;">
            <h2 style="background: linear-gradient(45deg, var(--success), var(--warning)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                Starko AI 4.0
            </h2>
            <div style="background: rgba(76, 201, 240, 0.2); border: 1px solid var(--success); color: var(--success); padding: 8px 16px; border-radius: 20px; font-size: 0.9rem; margin: 10px 0;">
                ONLINE
            </div>
        </div>
        
        <div class="sidebar-menu" style="padding: 20px 0;">
            <div class="menu-item clickable" data-section="dashboard" style="padding: 15px 25px; display: flex; align-items: center; gap: 15px; border-left: 4px solid var(--success); background: rgba(255,255,255,0.1);">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </div>
            <div class="menu-item clickable" data-section="profiles" style="padding: 15px 25px; display: flex; align-items: center; gap: 15px; border-left: 4px solid transparent;">
                <i class="fas fa-sliders-h"></i>
                <span>Profily</span>
            </div>
            <div class="menu-item clickable" data-section="performance" style="padding: 15px 25px; display: flex; align-items: center; gap: 15px; border-left: 4px solid transparent;">
                <i class="fas fa-microchip"></i>
                <span>V√Ωkon</span>
            </div>
            <div class="menu-item clickable" data-section="security" style="padding: 15px 25px; display: flex; align-items: center; gap: 15px; border-left: 4px solid transparent;">
                <i class="fas fa-shield-alt"></i>
                <span>Bezpeƒçnost</span>
            </div>
            {% if user.role == 'admin' %}
            <div class="menu-item clickable" data-section="users" style="padding: 15px 25px; display: flex; align-items: center; gap: 15px; border-left: 4px solid transparent;">
                <i class="fas fa-users"></i>
                <span>Spr√°va u≈æivatel≈Ø</span>
            </div>
            {% endif %}
            <div class="menu-item clickable" data-section="ai" style="padding: 15px 25px; display: flex; align-items: center; gap: 15px; border-left: 4px solid transparent;">
                <i class="fas fa-robot"></i>
                <span>AI Asistent</span>
            </div>
        </div>
    </div>
    
    <!-- HLAVN√ç OBSAH -->
    <div class="main-content">
        <!-- HLAVIƒåKA -->
        <div class="header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding: 25px; background: rgba(255,255,255,0.05); border-radius: 15px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1);">
            <div>
                <h1 style="font-size: 2.2rem; background: linear-gradient(45deg, var(--success), var(--warning)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                    Starko AI Workspace 4.0
                </h1>
                <p style="color: #a0a0a0;">Roz≈°√≠≈ôen√Ω dashboard pro spr√°vu workspace</p>
            </div>
            <div class="user-info" style="display: flex; align-items: center; gap: 15px;">
                <div class="user-avatar" style="width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(45deg, var(--primary), var(--secondary)); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 1.2rem;">
                    {{ user.username[0] | upper }}
                </div>
                <div>
                    <div style="font-weight: 600;">{{ user.username }}</div>
                    <div style="font-size: 0.9rem; color: var(--success);">{{ user.role }}</div>
                </div>
                <a href="{{ url_for('logout') }}" style="margin-left: 15px; padding: 8px 16px; background: rgba(230, 57, 70, 0.2); border: 1px solid var(--danger); border-radius: 8px; color: var(--danger); text-decoration: none; transition: all 0.3s;" 
                   onmouseover="this.style.background='rgba(230, 57, 70, 0.4)'" 
                   onmouseout="this.style.background='rgba(230, 57, 70, 0.2)'">
                    Odhl√°sit
                </a>
            </div>
        </div>
        
        <!-- RYCHL√ù P≈òEHLED -->
        <div class="dashboard-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
            <!-- STATISTIKY SYST√âMU -->
            <div class="widget">
                <div class="widget-header" style="padding: 20px; background: rgba(255,255,255,0.08); border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <div class="widget-title" style="font-size: 1.2rem; font-weight: 600; color: var(--success);">
                        üñ•Ô∏è Stav Syst√©mu
                    </div>
                </div>
                <div class="widget-content" style="padding: 20px;">
                    <div class="progress-container" style="margin: 15px 0;">
                        <div class="progress-label" style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span>CPU</span>
                            <span id="cpu-value">0%</span>
                        </div>
                        <div class="progress-bar" style="height: 8px; background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden;">
                            <div class="progress-fill cpu-progress" style="height: 100%; border-radius: 10px; transition: width 0.5s ease; background: linear-gradient(90deg, var(--primary), var(--secondary)); width: 0%;"></div>
                        </div>
                    </div>
                    
                    <div class="progress-container" style="margin: 15px 0;">
                        <div class="progress-label" style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span>RAM</span>
                            <span id="ram-value">0%</span>
                        </div>
                        <div class="progress-bar" style="height: 8px; background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden;">
                            <div class="progress-fill ram-progress" style="height: 100%; border-radius: 10px; transition: width 0.5s ease; background: linear-gradient(90deg, var(--success), #2ecc71); width: 0%;"></div>
                        </div>
                    </div>
                    
                    <div class="stats-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 20px;">
                        <div class="stat-card clickable" style="background: rgba(255,255,255,0.08); border-radius: 10px; padding: 15px; text-align: center;">
                            <i class="fas fa-thermometer-half" style="color: var(--warning);"></i>
                            <div class="stat-value" id="temp-value" style="font-size: 1.5rem; font-weight: 700; margin: 8px 0;">0¬∞C</div>
                            <div class="stat-label" style="font-size: 0.8rem; color: #a0a0a0;">Teplota</div>
                        </div>
                        
                        <div class="stat-card clickable" style="background: rgba(255,255,255,0.08); border-radius: 10px; padding: 15px; text-align: center;">
                            <i class="fas fa-users" style="color: var(--success);"></i>
                            <div class="stat-value" id="users-value" style="font-size: 1.5rem; font-weight: 700; margin: 8px 0;">0</div>
                            <div class="stat-label" style="font-size: 0.8rem; color: #a0a0a0;">U≈æivatel√©</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- SYST√âMOV√â PROFILY -->
            <div class="widget">
                <div class="widget-header" style="padding: 20px; background: rgba(255,255,255,0.08); border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <div class="widget-title" style="font-size: 1.2rem; font-weight: 600; color: var(--success);">
                        üéØ Syst√©mov√© Profily
                    </div>
                </div>
                <div class="widget-content" style="padding: 20px;">
                    <div class="profiles-container" id="profiles-container" style="display: grid; gap: 15px; max-height: 300px; overflow-y: auto;">
                        <!-- Naplnƒõno JavaScriptem -->
                    </div>
                </div>
            </div>
            
            <!-- AI ASISTENT -->
            <div class="widget">
                <div class="widget-header" style="padding: 20px; background: rgba(255,255,255,0.08); border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <div class="widget-title" style="font-size: 1.2rem; font-weight: 600; color: var(--success);">
                        ü§ñ AI Asistent
                    </div>
                </div>
                <div class="widget-content" style="padding: 20px;">
                    <div class="chat-container" style="display: flex; flex-direction: column; height: 200px;">
                        <div class="chat-messages" id="chat-messages" style="flex: 1; overflow-y: auto; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 10px; margin-bottom: 10px; font-size: 0.9rem;">
                            <div class="message" style="display: flex; margin-bottom: 10px;">
                                <div class="message-avatar" style="width: 25px; height: 25px; border-radius: 50%; background: var(--success); display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.7rem; margin-right: 10px;">AI</div>
                                <div class="message-content" style="background: rgba(255,255,255,0.1); padding: 8px 12px; border-radius: 12px; max-width: 80%;">
                                    Ahoj! Jsem v√°≈° AI asistent. Jak v√°m mohu pomoci?
                                </div>
                            </div>
                        </div>
                        <div class="chat-input" style="display: flex; gap: 10px;">
                            <input type="text" id="chat-input" placeholder="Zeptejte se..." style="flex: 1; padding: 10px; border: 1px solid rgba(255,255,255,0.2); border-radius: 20px; background: rgba(255,255,255,0.1); color: white; outline: none;">
                            <button id="send-message" style="padding: 10px 15px; border: none; border-radius: 20px; background: var(--primary); color: white; cursor: pointer;">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- SPR√ÅVA U≈ΩIVATEL≈Æ (pouze pro adminy) -->
        {% if user.role == 'admin' %}
        <div class="widget" id="users-section" style="display: none;">
            <div class="widget-header" style="padding: 20px; background: rgba(255,255,255,0.08); border-bottom: 1px solid rgba(255,255,255,0.1);">
                <div class="widget-title" style="font-size: 1.2rem; font-weight: 600; color: var(--success);">
                    üë• Spr√°va U≈æivatel≈Ø
                </div>
            </div>
            <div class="widget-content" style="padding: 20px;">
                <div style="margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px;">Vytvo≈ôit nov√©ho u≈æivatele</h3>
                    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                        <input type="text" id="new-username" placeholder="U≈æivatelsk√© jm√©no" style="flex: 1; padding: 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.1); color: white;">
                        <input type="password" id="new-password" placeholder="Heslo" style="flex: 1; padding: 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.1); color: white;">
                        <select id="new-role" style="padding: 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.1); color: white;">
                            <option value="user">U≈æivatel</option>
                            <option value="admin">Admin</option>
                        </select>
                        <button onclick="createUser()" style="padding: 12px 20px; background: var(--success); border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: 600;">
                            Vytvo≈ôit
                        </button>
                    </div>
                </div>
                
                <div id="users-list">
                    <!-- Seznam u≈æivatel≈Ø -->
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <script>
        // INTERAKTIVITA - v≈°echny panely reaguj√≠ na kliknut√≠
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            loadSystemStatus();
            loadProfiles();
            setupChat();
            {% if user.role == 'admin' %}loadUsers();{% endif %}
            
            // Rychl√° aktualizace ka≈æd√© 2 sekundy
            setInterval(loadSystemStatus, 2000);
        });

        function initializeDashboard() {
            // Menu klik√°n√≠
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', function() {
                    // Odstranit aktivn√≠ stav
                    document.querySelectorAll('.menu-item').forEach(i => {
                        i.style.background = 'transparent';
                        i.style.borderLeftColor = 'transparent';
                    });
                    
                    // Aktivovat vybran√©
                    this.style.background = 'rgba(255,255,255,0.1)';
                    this.style.borderLeftColor = 'var(--success)';
                    
                    // Zobrazit p≈ô√≠slu≈°nou sekci
                    const section = this.dataset.section;
                    showSection(section);
                });
            });
        }

        function showSection(section) {
            // Skr√Ωt v≈°echny sekce kromƒõ dashboardu
            const sections = ['users-section', 'profiles-section', 'performance-section', 'security-section', 'ai-section'];
            sections.forEach(sec => {
                const el = document.getElementById(sec);
                if (el) el.style.display = 'none';
            });
            
            // Zobrazit vybranou sekci
            if (section !== 'dashboard') {
                const targetSection = document.getElementById(section + '-section');
                if (targetSection) {
                    targetSection.style.display = 'block';
                }
            }
        }

        async function loadSystemStatus() {
            try {
                const response = await fetch('/api/system/status');
                const data = await response.json();
                
                // Aktualizovat UI
                document.getElementById('cpu-value').textContent = data.cpu.toFixed(1) + '%';
                document.getElementById('ram-value').textContent = data.ram.toFixed(1) + '%';
                document.getElementById('temp-value').textContent = data.temperature.toFixed(1) + '¬∞C';
                document.getElementById('users-value').textContent = data.active_users;
                
                // Progress bary
                document.querySelector('.cpu-progress').style.width = data.cpu + '%';
                document.querySelector('.ram-progress').style.width = data.ram + '%';
                
            } catch (error) {
                console.error('Chyba:', error);
            }
        }

        async function loadProfiles() {
            try {
                const response = await fetch('/api/profiles');
                const profiles = await response.json();
                
                const container = document.getElementById('profiles-container');
                container.innerHTML = '';
                
                profiles.forEach(profile => {
                    const profileCard = document.createElement('div');
                    profileCard.className = `profile-card clickable ${profile.active ? 'active' : ''}`;
                    profileCard.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="font-size: 1.5rem;">${profile.icon}</div>
                            <div style="flex: 1;">
                                <h3 style="margin-bottom: 5px;">${profile.name}</h3>
                                <p style="color: #b0b0b0; font-size: 0.9rem; margin-bottom: 8px;">${profile.description}</p>
                                <span style="background: rgba(76, 201, 240, 0.2); color: var(--success); padding: 4px 10px; border-radius: 12px; font-size: 0.8rem;">
                                    ${profile.extensions} roz≈°√≠≈ôen√≠
                                </span>
                            </div>
                        </div>
                    `;
                    profileCard.onclick = () => activateProfile(profile.id);
                    container.appendChild(profileCard);
                });
                
            } catch (error) {
                console.error('Chyba:', error);
            }
        }

        async function activateProfile(profileId) {
            try {
                const response = await fetch('/api/profiles/activate', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({profile_id: profileId})
                });
                
                if (response.ok) {
                    loadProfiles();
                    addChatMessage('bot', `Profil aktivov√°n! üéâ`);
                }
            } catch (error) {
                console.error('Chyba:', error);
            }
        }

        function setupChat() {
            const chatInput = document.getElementById('chat-input');
            const sendButton = document.getElementById('send-message');
            
            function sendMessage() {
                const message = chatInput.value.trim();
                if (!message) return;
                
                addChatMessage('user', message);
                chatInput.value = '';
                
                // AI odpovƒõƒè
                fetch('/api/ai/chat', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({message: message})
                })
                .then(response => response.json())
                .then(data => {
                    addChatMessage('bot', data.response);
                });
            }
            
            sendButton.addEventListener('click', sendMessage);
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });
        }

        function addChatMessage(sender, text) {
            const messagesContainer = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            messageDiv.style.display = 'flex';
            messageDiv.style.marginBottom = '10px';
            messageDiv.style.flexDirection = sender === 'user' ? 'row-reverse' : 'row';
            
            messageDiv.innerHTML = `
                <div class="message-avatar" style="width: 25px; height: 25px; border-radius: 50%; background: ${sender === 'user' ? 'var(--primary)' : 'var(--success)'}; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.7rem; margin: 0 10px;">
                    ${sender === 'user' ? 'Vy' : 'AI'}
                </div>
                <div class="message-content" style="background: ${sender === 'user' ? 'var(--primary)' : 'rgba(255,255,255,0.1)'}; padding: 8px 12px; border-radius: 12px; max-width: 80%;">
                    ${text}
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        {% if user.role == 'admin' %}
        async function loadUsers() {
            try {
                const response = await fetch('/api/users');
                const users = await response.json();
                
                const container = document.getElementById('users-list');
                container.innerHTML = '<h3 style="margin-bottom: 15px;">Seznam u≈æivatel≈Ø</h3>';
                
                users.forEach(user => {
                    const userDiv = document.createElement('div');
                    userDiv.style.cssText = `
                        background: rgba(255,255,255,0.08);
                        padding: 15px;
                        border-radius: 10px;
                        margin: 10px 0;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                    `;
                    userDiv.innerHTML = `
                        <div>
                            <strong>${user.username}</strong>
                            <span style="margin-left: 10px; padding: 4px 8px; background: ${user.role === 'admin' ? 'var(--warning)' : 'var(--success)'}; border-radius: 8px; font-size: 0.8rem;">
                                ${user.role}
                            </span>
                            <div style="font-size: 0.8rem; color: #a0a0a0; margin-top: 5px;">
                                Vytvo≈ôeno: ${new Date(user.created_at).toLocaleDateString('cs-CZ')}
                            </div>
                        </div>
                        <div>
                            ${user.username !== '{{ user.username }}' ? 
                                `<button onclick="deleteUser(${user.id})" style="padding: 8px 15px; background: var(--danger); border: none; border-radius: 6px; color: white; cursor: pointer;">
                                    Smazat
                                </button>` : 
                                `<span style="color: var(--gray);">Aktivn√≠ u≈æivatel</span>`
                            }
                        </div>
                    `;
                    container.appendChild(userDiv);
                });
                
            } catch (error) {
                console.error('Chyba:', error);
            }
        }

        async function createUser() {
            const username = document.getElementById('new-username').value;
            const password = document.getElementById('new-password').value;
            const role = document.getElementById('new-role').value;

            if (!username || !password) {
                alert('Vypl≈àte v≈°echny √∫daje');
                return;
            }

            try {
                const response = await fetch('/api/users/create', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({username, password, role})
                });

                const result = await response.json();
                
                if (response.ok) {
                    document.getElementById('new-username').value = '';
                    document.getElementById('new-password').value = '';
                    loadUsers();
                    addChatMessage('bot', `U≈æivatel ${username} vytvo≈ôen ‚úÖ`);
                } else {
                    alert(result.error);
                }
            } catch (error) {
                console.error('Chyba:', error);
            }
        }

        async function deleteUser(userId) {
            if (!confirm('Opravdu chcete smazat tohoto u≈æivatele?')) return;

            try {
                const response = await fetch(`/api/users/${userId}/delete`, {
                    method: 'POST'
                });

                if (response.ok) {
                    loadUsers();
                    addChatMessage('bot', 'U≈æivatel smaz√°n ‚úÖ');
                } else {
                    const error = await response.json();
                    alert(error.error);
                }
            } catch (error) {
                console.error('Chyba:', error);
            }
        }
        {% endif %}
    </script>
</body>
</html>
