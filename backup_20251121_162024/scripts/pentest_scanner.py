#!/usr/bin/env python3
"""
Starko PenTest Scanner - Multi-tool security scanner
"""

import subprocess
import sys
import json
import argparse
from datetime import datetime

class PenTestScanner:
    def __init__(self):
        self.results = {}
        
    def nmap_scan(self, target, options="-sS -sV -O"):
        """Perform Nmap scan"""
        print(f"[+] Starting Nmap scan on {target}")
        cmd = f"nmap {options} {target}"
        try:
            result = subprocess.run(cmd.split(), capture_output=True, text=True)
            self.results['nmap'] = result.stdout
            return result.stdout
        except Exception as e:
            return f"Error: {e}"
    
    def directory_bruteforce(self, url, wordlist=None):
        """Directory bruteforce scan"""
        print(f"[+] Scanning {url} for directories")
        if not wordlist:
            wordlist = "/usr/share/wordlists/dirb/common.txt"
        
        cmd = f"gobuster dir -u {url} -w {wordlist} -q"
        try:
            result = subprocess.run(cmd.split(), capture_output=True, text=True)
            self.results['gobuster'] = result.stdout
            return result.stdout
        except Exception as e:
            return f"Error: {e}"
    
    def generate_report(self, output_file="pentest_report.html"):
        """Generate HTML report"""
        timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        
        html_template = f"""
        <!DOCTYPE html>
        <html>
        <head>
            <title>PenTest Report - {timestamp}</title>
            <style>
                body {{ font-family: Arial, sans-serif; margin: 20px; }}
                .section {{ margin: 20px 0; padding: 15px; background: #f5f5f5; }}
                pre {{ background: white; padding: 10px; overflow-x: auto; }}
            </style>
        </head>
        <body>
            <h1>Security Assessment Report</h1>
            <p>Generated: {timestamp}</p>
            
            <div class="section">
                <h2>Nmap Results</h2>
                <pre>{self.results.get('nmap', 'No data')}</pre>
            </div>
            
            <div class="section">
                <h2>Directory Scan</h2>
                <pre>{self.results.get('gobuster', 'No data')}</pre>
            </div>
        </body>
        </html>
        """
        
        with open(output_file, 'w') as f:
            f.write(html_template)
        
        print(f"[+] Report generated: {output_file}")

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="Starko PenTest Scanner")
    parser.add_argument("target", help="Target IP or URL")
    parser.add_argument("-p", "--port", help="Port range for scanning")
    parser.add_argument("-o", "--output", help="Output file for report")
    
    args = parser.parse_args()
    
    scanner = PenTestScanner()
    scanner.nmap_scan(args.target)
    scanner.generate_report(args.output or "pentest_report.html")
